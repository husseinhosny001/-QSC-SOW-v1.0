Ù…Ù‚Ø±Ù† Ø§Ù„Ù…Ø­Ø²ÙˆØ² Ø§Ù„Ù…ØªÙ‚Ø¯Ù… (Grating Coupler) - Ù„Ù„Ø±Ù‚Ø§Ù‚Ø© Ø§Ù„ÙƒÙ…ÙˆÙ…ÙŠØ© Ø§Ù„Ø¶ÙˆØ¦ÙŠØ©

ğŸ“ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠ ÙˆØ§Ù„ÙÙŠØ²ÙŠØ§Ø¦ÙŠ

1. Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…Ø­Ø²ÙˆØ²

Ù…Ù‚Ø±Ù† Ø§Ù„Ù…Ø­Ø²ÙˆØ² ÙŠØ­ÙˆÙ„ Ø§Ù„Ø¶ÙˆØ¡ Ù…Ù† Ø§Ù„Ø£Ù„ÙŠØ§Ù Ø¥Ù„Ù‰ Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¬ÙŠ ÙÙŠ Ø§Ù„Ø±Ù‚Ø§Ù‚Ø© ÙˆØ§Ù„Ø¹ÙƒØ³. Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©:

n_{\text{eff}} = n_{\text{clad}} \sin(\theta) + \frac{m\lambda}{\Lambda}

Ø­ÙŠØ«:

Â·  n_{\text{eff}} : Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø§Ù†ÙƒØ³Ø§Ø± Ø§Ù„ÙØ¹Ø§Ù„ Ù„Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¬ÙŠ
Â·  n_{\text{clad}} : Ù…Ø¹Ø§Ù…Ù„ Ø§Ù†ÙƒØ³Ø§Ø± Ø§Ù„ØºØ·Ø§Ø¡ (Ø¹Ø§Ø¯Ø© SiOâ‚‚ = 1.44)
Â·  \theta : Ø²Ø§ÙˆÙŠØ© Ø§Ù„Ø³Ù‚ÙˆØ· (Ø¹Ø§Ø¯Ø© 8-12Â°)
Â·  m : Ø±ØªØ¨Ø© Ø§Ù„Ù…Ø­Ø²ÙˆØ² (Ø¹Ø§Ø¯Ø© m=1)
Â·  \lambda : Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¬ÙŠ (1550 Ù†Ø§Ù†ÙˆÙ…ØªØ±)
Â·  \Lambda : Ø¯ÙˆØ±Ø© Ø§Ù„Ù…Ø­Ø²ÙˆØ²

2. Ù…Ù„Ù Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„ÙƒØ§Ù…Ù„

Ù…Ù„Ù: /03_FABRICATION/component_library/grating_coupler.py

```python
"""
Ù…Ù‚Ø±Ù† Ù…Ø­Ø²ÙˆØ² Ù…ØªÙ‚Ø¯Ù… Ù„Ù„Ø±Ù‚Ø§Ù‚Ø© Ø§Ù„ÙƒÙ…ÙˆÙ…ÙŠØ© Ø§Ù„Ø¶ÙˆØ¦ÙŠØ©.
ÙŠØ¯Ø¹Ù…: ØªØµÙ…ÙŠÙ… Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ø£Ø·ÙˆØ§Ù„ Ø§Ù„Ù…ÙˆØ¬ÙŠØ©ØŒ ØªØ­Ø³ÙŠÙ† Ø§Ù„ÙƒÙØ§Ø¡Ø©ØŒ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø³ØªÙ‚Ø·Ø§Ø¨.
"""
import numpy as np
import gdspy
import yaml
from typing import Tuple, List, Dict, Optional
import json
from dataclasses import dataclass
from math import sin, cos, tan, radians, degrees, sqrt

@dataclass
class GratingDesignParameters:
    """Ù…Ø¹Ù„Ù…Ø§Øª ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…Ø­Ø²ÙˆØ²."""
    wavelength: float = 1.55  # Î¼m
    wavelength_bandwidth: float = 0.04  # Â±40 nm
    angle_of_incidence: float = 10.0  # Ø¯Ø±Ø¬Ø§Øª
    polarization: str = "TE"  # TE Ø£Ùˆ TM
    target_efficiency: float = 0.6  # 60% ÙƒÙØ§Ø¡Ø©
    material_system: str = "Si3N4_SiO2"  # Siâ‚ƒNâ‚„ Ø¹Ù„Ù‰ SiOâ‚‚
    
    # Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ø§Ù†ÙƒØ³Ø§Ø± @ 1550nm
    n_core: float = 2.0      # Siâ‚ƒNâ‚„
    n_cladding: float = 1.44  # SiOâ‚‚
    n_superstrate: float = 1.0  # Ù‡ÙˆØ§Ø¡
    
    # Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„Ø·Ø¨Ù‚Ø©
    core_thickness: float = 0.22  # Î¼m
    etch_depth: float = 0.11      # Î¼m (Ù†ØµÙ Ø§Ù„Ø³Ù…Ø§ÙƒØ©)
    
    # Ù…Ø¹Ù„Ù…Ø§Øª Ø§Ù„Ù…Ø­Ø²ÙˆØ²
    grating_period: Optional[float] = None  # Ø³ØªØ­Ø³Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
    fill_factor: float = 0.5      # Ù†Ø³Ø¨Ø© Ø§Ù„Ø³Ù†Ø§Ù† Ø¥Ù„Ù‰ Ø§Ù„ÙØ±Ø§Øº
    number_of_periods: int = 20   # Ø¹Ø¯Ø¯ Ø§Ù„Ø¯ÙˆØ±Ø§Øª
    tooth_width: Optional[float] = None
    gap_width: Optional[float] = None

class AdvancedGratingCoupler:
    """Ù…Ù‚Ø±Ù† Ù…Ø­Ø²ÙˆØ² Ù…ØªÙ‚Ø¯Ù… Ù…Ø¹ ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„ÙƒÙØ§Ø¡Ø© ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø³ØªÙ‚Ø·Ø§Ø¨."""
    
    def __init__(self, params: GratingDesignParameters = None):
        self.params = params or GratingDesignParameters()
        self._calculate_design_parameters()
        
        # ØªØ­Ù…ÙŠÙ„ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„ØªØµÙ…ÙŠÙ…
        with open('../PDK/design_rules.yaml', 'r') as f:
            self.drc = yaml.safe_load(f)
        
        # Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø©
        self.simulation_results = {}
        self.geometry_cells = {}
    
    def _calculate_design_parameters(self):
        """Ø­Ø³Ø§Ø¨ Ù…Ø¹Ù„Ù…Ø§Øª Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©."""
        Î» = self.params.wavelength
        Î¸ = radians(self.params.angle_of_incidence)
        
        # 1. Ø­Ø³Ø§Ø¨ Ø¯ÙˆØ±Ø© Ø§Ù„Ù…Ø­Ø²ÙˆØ² Ù…Ù† Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ù…Ø­Ø²ÙˆØ²
        # n_eff = n_clad * sin(Î¸) + m * Î» / Î›
        # Ù†ÙØªØ±Ø¶ m = 1 Ù„Ù„Ø±ØªØ¨Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰
        
        # ØªÙ‚Ø¯ÙŠØ± n_eff Ù„Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¬ÙŠ Siâ‚ƒNâ‚„ 220nm
        n_eff_approx = 1.7  # Ù‚ÙŠÙ…Ø© ØªÙ‚Ø±ÙŠØ¨ÙŠØ© Ù„Ù€ Siâ‚ƒNâ‚„ 220nm @ 1550nm
        
        self.params.grating_period = Î» / (
            n_eff_approx - self.params.n_cladding * sin(Î¸)
        )
        
        # 2. Ø­Ø³Ø§Ø¨ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ù† ÙˆØ§Ù„ÙØ±Ø§Øº
        if self.params.tooth_width is None:
            self.params.tooth_width = (
                self.params.grating_period * self.params.fill_factor
            )
        
        if self.params.gap_width is None:
            self.params.gap_width = (
                self.params.grating_period - self.params.tooth_width
            )
        
        # 3. Ø­Ø³Ø§Ø¨ Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„ÙƒÙ„ÙŠ
        self.total_length = (
            self.params.number_of_periods * self.params.grating_period
        )
        
        # 4. Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹Ø±Ø¶ (Ø¹Ù„Ù‰ Ø£Ø³Ø§Ø³ Ø¹Ø±Ø¶ Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¬ÙŠ + ØªÙˆØ³ÙŠØ¹)
        self.taper_width_start = 0.5  # Î¼m (Ø¹Ø±Ø¶ Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¬ÙŠ)
        self.taper_width_end = 12.0   # Î¼m (Ø¹Ø±Ø¶ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø­Ø²ÙˆØ²)
        
        print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
        print("  Ù…Ø¹Ù„Ù…Ø§Øª ØªØµÙ…ÙŠÙ… Ù…Ù‚Ø±Ù† Ø§Ù„Ù…Ø­Ø²ÙˆØ² Ø§Ù„Ù…Ø­Ø³ÙˆØ¨Ø©")
        print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
        print(f"â€¢ Ø¯ÙˆØ±Ø© Ø§Ù„Ù…Ø­Ø²ÙˆØ² (Î›): {self.params.grating_period:.3f} Î¼m")
        print(f"â€¢ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ù†: {self.params.tooth_width:.3f} Î¼m")
        print(f"â€¢ Ø¹Ø±Ø¶ Ø§Ù„ÙØ±Ø§Øº: {self.params.gap_width:.3f} Î¼m")
        print(f"â€¢ Ø¹Ø¯Ø¯ Ø§Ù„Ø¯ÙˆØ±Ø§Øª: {self.params.number_of_periods}")
        print(f"â€¢ Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„ÙƒÙ„ÙŠ: {self.total_length:.1f} Î¼m")
        print(f"â€¢ Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ù„Ø¡: {self.params.fill_factor:.1%}")
        print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
    
    def create_grating_structure(self, position: Tuple[float, float] = (0, 0),
                                orientation: str = "input") -> gdspy.Cell:
        """
        Ø¥Ù†Ø´Ø§Ø¡ Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ø­Ø²ÙˆØ² Ø§Ù„ÙƒØ§Ù…Ù„.
        
        Args:
            position: Ù…ÙˆØ¶Ø¹ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© (x, y)
            orientation: "input" Ø£Ùˆ "output" (ÙŠØ­Ø¯Ø¯ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„ØªØ¯Ø±Ø¬)
            
        Returns:
            Ø®Ù„ÙŠØ© GDS ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­Ø²ÙˆØ²
        """
        cell = gdspy.Cell(f"GC_{orientation}_{self.params.wavelength}nm")
        
        # 1. Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªØ¯Ø±Ø¬ (Taper)
        taper = self._create_taper_section(position, orientation)
        cell.add(taper)
        
        # 2. Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø­Ø²ÙˆØ²
        grating_start = (
            position[0] + (10 if orientation == "input" else 0),
            position[1]
        )
        
        grating_cell = self._create_grating_teeth(grating_start, orientation)
        cell.add(grating_cell)
        
        # 3. Ø¥Ø¶Ø§ÙØ© Ø¹Ù„Ø§Ù…Ø§Øª Ù…Ø­Ø§Ø°Ø§Ø© ÙˆÙ…Ø­Ø§Ø°Ø§Ø© Ø¨ØµØ±ÙŠØ©
        alignment = self._create_alignment_marks(position)
        cell.add(alignment)
        
        # 4. Ø¥Ø¶Ø§ÙØ© Ù†ØµÙˆØµ ØªØ¹Ø±ÙŠÙÙŠØ©
        text = self._add_design_labels(position)
        cell.add(text)
        
        return cell
    
    def _create_taper_section(self, start_pos: Tuple[float, float],
                             orientation: str) -> gdspy.PolygonSet:
        """
        Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªØ¯Ø±Ø¬ Ù…Ù† Ø¹Ø±Ø¶ Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¬ÙŠ Ø¥Ù„Ù‰ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­Ø²ÙˆØ².
        
        Ø§Ù„ØªØ¯Ø±Ø¬ Ø§Ù„Ø®Ø·ÙŠ: w(z) = w_start + (w_end - w_start) * (z/L)
        """
        taper_length = 100.0  # Î¼m
        
        # ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø§ØªØ¬Ø§Ù‡
        if orientation == "input":
            # Ù…Ù† Ø§Ù„Ù…Ø­Ø²ÙˆØ² Ø¥Ù„Ù‰ Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¬ÙŠ
            width_start = self.taper_width_end
            width_end = self.taper_width_start
            x_start, y_start = start_pos
            x_end = x_start - taper_length
        else:  # output
            # Ù…Ù† Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¬ÙŠ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø­Ø²ÙˆØ²
            width_start = self.taper_width_start
            width_end = self.taper_width_end
            x_start, y_start = start_pos
            x_end = x_start + taper_length
        
        # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¶Ù„Ø¹ Ø§Ù„ØªØ¯Ø±Ø¬
        points = [
            (x_start, y_start + width_start/2),
            (x_start, y_start - width_start/2),
            (x_end, y_start - width_end/2),
            (x_end, y_start + width_end/2)
        ]
        
        taper = gdspy.Polygon(points, layer=self._get_layer("waveguide"))
        
        # Ø¥Ø¶Ø§ÙØ© ØªØ¯Ø±Ø¬ Ù…ÙØµÙ„ (Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø®Ø³Ø§Ø¦Ø±)
        detailed_taper = self._create_detailed_taper(
            start_pos, taper_length, width_start, width_end, orientation
        )
        
        return detailed_taper if detailed_taper else taper
    
    def _create_detailed_taper(self, start_pos: Tuple[float, float],
                              length: float, w1: float, w2: float,
                              orientation: str) -> gdspy.Cell:
        """Ø¥Ù†Ø´Ø§Ø¡ ØªØ¯Ø±Ø¬ Ù…ÙØµÙ‘Ù„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ù†Ø­Ù†ÙŠØ§Øª Ø¬ÙŠØ¨ÙŠØ© Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø®Ø³Ø§Ø¦Ø±."""
        cell = gdspy.Cell("DetailedTaper")
        
        # Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ù†Ø­Ù†Ù‰ Ø¬ÙŠØ¨ÙŠ Ù„Ù„ØªØ¯Ø±Ø¬: w(z) = w1 + (w2-w1) * sinÂ²(Ï€z/2L)
        num_segments = 20
        segment_length = length / num_segments
        
        for i in range(num_segments):
            z1 = i * segment_length
            z2 = (i + 1) * segment_length
            
            # Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹Ø±Ø¶ Ø¹Ù†Ø¯ ÙƒÙ„ Ù†Ù‚Ø·Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ù†Ø­Ù†Ù‰ Ø¬ÙŠØ¨ÙŠ
            width1 = w1 + (w2 - w1) * (sin(radians(90 * z1 / length)) ** 2)
            width2 = w1 + (w2 - w1) * (sin(radians(90 * z2 / length)) ** 2)
            
            # ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø§ØªØ¬Ø§Ù‡
            if orientation == "input":
                x1 = start_pos[0] - z1
                x2 = start_pos[0] - z2
            else:
                x1 = start_pos[0] + z1
                x2 = start_pos[0] + z2
            
            y = start_pos[1]
            
            # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù‚Ø·Ø¹ Ø§Ù„ØªØ¯Ø±Ø¬
            points = [
                (x1, y + width1/2),
                (x1, y - width1/2),
                (x2, y - width2/2),
                (x2, y + width2/2)
            ]
            
            segment = gdspy.Polygon(points, layer=self._get_layer("waveguide"))
            cell.add(segment)
        
        return cell
    
    def _create_grating_teeth(self, start_pos: Tuple[float, float],
                             orientation: str) -> gdspy.Cell:
        """
        Ø¥Ù†Ø´Ø§Ø¡ Ø£Ø³Ù†Ø§Ù† Ø§Ù„Ù…Ø­Ø²ÙˆØ² Ù…Ø¹ ØªØ¯Ø±Ø¬ ÙÙŠ Ø§Ù„Ø¯ÙˆØ±Ø© Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„ØªØ±Ø¯Ø¯ÙŠ.
        
        Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªØ¯Ø±Ø¬ Ø§Ù„Ø®Ø·ÙŠ ÙÙŠ Ø§Ù„Ø¯ÙˆØ±Ø©: Î›(z) = Î›â‚€ + Î±*z
        """
        cell = gdspy.Cell("GratingTeeth")
        
        Î›0 = self.params.grating_period  # Ø§Ù„Ø¯ÙˆØ±Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
        Î± = 0.002  # Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„ØªØ¯Ø±Ø¬ (0.2% Ø²ÙŠØ§Ø¯Ø© Ù„ÙƒÙ„ Ù…ÙŠÙƒØ±ÙˆÙ…ØªØ±)
        
        # Ù…Ø¹Ù„Ù…Ø§Øª Ø§Ù„ØªØµÙ…ÙŠÙ…
        tooth_width = self.params.tooth_width
        fill_factor = self.params.fill_factor
        
        current_x = start_pos[0]
        y_center = start_pos[1]
        
        # Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„ÙŠ Ù„Ù„Ù…Ø­Ø²ÙˆØ² (ÙŠØªÙ†Ø§Ù‚Øµ Ù…Ø¹ Ø§Ù„Ù…Ø³Ø§ÙØ©)
        grating_width = self.taper_width_end
        
        for i in range(self.params.number_of_periods):
            # Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¯ÙˆØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù…Ø¹ Ø§Ù„ØªØ¯Ø±Ø¬
            current_period = Î›0 * (1 + Î± * i)
            
            # Ø­Ø³Ø§Ø¨ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ù† ÙˆØ§Ù„ÙØ±Ø§Øº Ø§Ù„Ø­Ø§Ù„ÙŠÙŠÙ†
            current_tooth = current_period * fill_factor
            current_gap = current_period * (1 - fill_factor)
            
            # ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø³Ù†
            tooth_x_start = current_x
            tooth_x_end = tooth_x_start + current_tooth
            
            # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø³Ù† (Ù…Ø³ØªØ·ÙŠÙ„)
            tooth_points = [
                (tooth_x_start, y_center - grating_width/2),
                (tooth_x_start, y_center + grating_width/2),
                (tooth_x_end, y_center + grating_width/2),
                (tooth_x_end, y_center - grating_width/2)
            ]
            
            tooth = gdspy.Polygon(tooth_points, layer=self._get_layer("waveguide"))
            cell.add(tooth)
            
            # ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ù„Ø¯ÙˆØ±Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©
            current_x += current_period
            
            # ØªÙ‚Ù„ÙŠÙ„ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­Ø²ÙˆØ² ØªØ¯Ø±ÙŠØ¬ÙŠØ§Ù‹ (Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø§Ù†ØªØ´Ø§Ø± Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ)
            if i % 5 == 0 and i > 0:
                grating_width *= 0.95
        
        return cell
    
    def _create_alignment_marks(self, position: Tuple[float, float]) -> gdspy.Cell:
        """Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù„Ø§Ù…Ø§Øª Ù…Ø­Ø§Ø°Ø§Ø© Ù„Ù„ØªØµÙ†ÙŠØ¹ ÙˆØ§Ù„Ø§Ø®ØªØ¨Ø§Ø±."""
        cell = gdspy.Cell("AlignmentMarks")
        
        # Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ø¨ØµØ±ÙŠØ© (Ù„Ø¶Ø¨Ø· Ø§Ù„Ø£Ù„ÙŠØ§Ù)
        mark_size = 5.0  # Î¼m
        
        # Ø¹Ù„Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø´ÙƒÙ„ ØµÙ„ÙŠØ¨
        cross_center = (position[0] + 50, position[1])
        
        # Ø§Ù„Ø®Ø· Ø§Ù„Ø£ÙÙ‚ÙŠ
        h_line = gdspy.Rectangle(
            (cross_center[0] - mark_size/2, cross_center[1] - 0.1),
            (cross_center[0] + mark_size/2, cross_center[1] + 0.1),
            layer=self._get_layer("alignment")
        )
        
        # Ø§Ù„Ø®Ø· Ø§Ù„Ø±Ø£Ø³ÙŠ
        v_line = gdspy.Rectangle(
            (cross_center[0] - 0.1, cross_center[1] - mark_size/2),
            (cross_center[0] + 0.1, cross_center[1] + mark_size/2),
            layer=self._get_layer("alignment")
        )
        
        # Ø¯Ø§Ø¦Ø±Ø© Ù…Ø±ÙƒØ²ÙŠØ©
        circle = gdspy.Round(
            cross_center,
            mark_size/4,
            layer=self._get_layer("alignment")
        )
        
        # Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ù…Ø³Ø§ÙØ©
        for offset in [-20, 0, 20]:
            distance_mark = gdspy.Rectangle(
                (cross_center[0] + offset, cross_center[1] - 1),
                (cross_center[0] + offset, cross_center[1] + 1),
                layer=self._get_layer("alignment")
            )
            cell.add(distance_mark)
        
        cell.add([h_line, v_line, circle])
        
        return cell
    
    def _add_design_labels(self, position: Tuple[float, float]) -> gdspy.Cell:
        """Ø¥Ø¶Ø§ÙØ© Ù†ØµÙˆØµ ØªØ¹Ø±ÙŠÙÙŠØ© ÙˆØªØµÙ…ÙŠÙ…ÙŠØ©."""
        cell = gdspy.Cell("DesignLabels")
        
        text_params = {
            "layer": self._get_layer("text"),
            "magnification": 10
        }
        
        # Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
        info_lines = [
            f"GC Design v1.0",
            f"Î»={self.params.wavelength}Î¼m, Î¸={self.params.angle_of_incidence}Â°",
            f"Î›={self.params.grating_period:.3f}Î¼m, FF={self.params.fill_factor:.1%}",
            f"Material: {self.params.material_system}",
            f"Polarization: {self.params.polarization}"
        ]
        
        y_offset = position[1] + 15
        
        for i, line in enumerate(info_lines):
            text = gdspy.Text(
                line,
                2,  # Ø­Ø¬Ù… Ø§Ù„Ø®Ø·
                (position[0] - 10, y_offset - i * 3),
                **text_params
            )
            cell.add(text)
        
        # Ø¥Ø´Ø§Ø±Ø© Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø¶ÙˆØ¡
        arrow_points = [
            (position[0] + 60, position[1]),
            (position[0] + 80, position[1]),
            (position[0] + 75, position[1] + 2),
            (position[0] + 80, position[1]),
            (position[0] + 75, position[1] - 2)
        ]
        
        arrow = gdspy.Polygon(arrow_points, layer=self._get_layer("text"))
        cell.add(arrow)
        
        arrow_text = gdspy.Text(
            "Light",
            3,
            (position[0] + 85, position[1] - 1),
            **text_params
        )
        cell.add(arrow_text)
        
        return cell
    
    def _get_layer(self, layer_type: str) -> int:
        """Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ù‚Ù… Ø§Ù„Ø·Ø¨Ù‚Ø© Ù…Ù† Ù†ÙˆØ¹Ù‡Ø§."""
        layer_map = {
            "waveguide": 1,      # Siâ‚ƒNâ‚„
            "nonlinear": 2,      # AlGaAs
            "heater": 10,        # TiN
            "via": 11,           # Ti
            "alignment": 0,      # Ø¹Ù„Ø§Ù…Ø§Øª Ù…Ø­Ø§Ø°Ø§Ø©
            "text": 100,         # Ù†ØµÙˆØµ
            "simulation": 200    # Ù…Ù†Ø§Ø·Ù‚ Ù…Ø­Ø§ÙƒØ§Ø©
        }
        
        return layer_map.get(layer_type, 1)
    
    def create_array_coupler(self, position: Tuple[float, float],
                           num_ports: int = 8,
                           spacing: float = 127.0) -> gdspy.Cell:
        """
        Ø¥Ù†Ø´Ø§Ø¡ Ù…ØµÙÙˆÙØ© Ù…Ù† Ù…Ù‚Ø±Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø²ÙˆØ² Ù„Ù„Ø¯Ø®Ù„/Ø®Ø±Ø¬ Ù…ØªØ¹Ø¯Ø¯Ø©.
        
        Args:
            position: Ù…ÙˆØ¶Ø¹ Ø£ÙˆÙ„ Ù…Ù‚Ø±Ù†
            num_ports: Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†Ø§ÙØ°
            spacing: Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ù…Ù†Ø§ÙØ° (Ø¹Ø§Ø¯Ø© 127Î¼m Ù„ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø£Ù„ÙŠØ§Ù)
            
        Returns:
            Ø®Ù„ÙŠØ© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…ØµÙÙˆÙØ© ÙƒØ§Ù…Ù„Ø©
        """
        cell = gdspy.Cell(f"GratingCoupler_Array_{num_ports}ports")
        
        # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù‚Ø±Ù†Ø§Øª ÙØ±Ø¯ÙŠØ©
        for i in range(num_ports):
            port_pos = (
                position[0],
                position[1] + i * spacing
            )
            
            # ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ (Ù…Ø¯Ø®Ù„Ø§Øª ÙØ±Ø¯ÙŠØ©ØŒ Ù…Ø®Ø§Ø±Ø¬ Ø²ÙˆØ¬ÙŠØ©)
            orientation = "input" if i % 2 == 0 else "output"
            
            # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù‚Ø±Ù† Ø§Ù„ÙØ±Ø¯ÙŠ
            gc_cell = self.create_grating_structure(port_pos, orientation)
            
            # Ø¥Ø¶Ø§ÙØ© ÙˆØµÙ„Ø© Ø¥Ù„Ù‰ Ø´Ø¨ÙƒØ© Ø§Ù„Ø¯ÙˆØ§Ø¦Ø± Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©
            waveguide = self._connect_to_internal_circuit(port_pos, orientation)
            
            cell.add(gc_cell)
            cell.add(waveguide)
            
            # Ø¥Ø¶Ø§ÙØ© ØªØ³Ù…ÙŠØ© Ø§Ù„Ù…Ù†ÙØ°
            port_label = gdspy.Text(
                f"Port_{i+1}",
                4,
                (port_pos[0] - 15, port_pos[1]),
                layer=self._get_layer("text")
            )
            cell.add(port_label)
        
        # Ø¥Ø¶Ø§ÙØ© Ø¥Ø·Ø§Ø± ÙˆÙ…Ø­Ø§Ø°Ø§Ø© Ù„Ù„Ù…ØµÙÙˆÙØ©
        frame = self._create_array_frame(position, num_ports, spacing)
        cell.add(frame)
        
        return cell
    
    def _connect_to_internal_circuit(self, port_pos: Tuple[float, float],
                                    orientation: str) -> gdspy.Cell:
        """Ø¥Ù†Ø´Ø§Ø¡ ÙˆØµÙ„Ø© Ù…Ù† Ø§Ù„Ù…Ø­Ø²ÙˆØ² Ø¥Ù„Ù‰ Ø§Ù„Ø¯ÙˆØ§Ø¦Ø± Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©."""
        cell = gdspy.Cell(f"Waveguide_Connection")
        
        # Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© (Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø­Ø²ÙˆØ²)
        if orientation == "input":
            start_point = (port_pos[0] - self.total_length - 100, port_pos[1])
        else:
            start_point = (port_pos[0] + self.total_length + 100, port_pos[1])
        
        # Ù†Ù‚Ø·Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ© (Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ø¦Ø± Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©)
        end_point = (start_point[0] + (150 if orientation == "input" else -150), 
                    start_point[1])
        
        # Ø¥Ù†Ø´Ø§Ø¡ Ø¯Ù„ÙŠÙ„ Ù…ÙˆØ¬ÙŠ Ù…Ø¹ Ù…Ù†Ø¹Ø·ÙØ§Øª Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ØªØ¯Ø§Ø®Ù„
points = self._calculate_waveguide_path(start_point, end_point)
        
        # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¬ÙŠ ÙƒØ®Ø· Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡
        waveguide = gdspy.FlexPath(
            points,
            width=0.5,  # Ø¹Ø±Ø¶ Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¬ÙŠ
            corners="circular",  # Ù…Ù†Ø¹Ø·ÙØ§Øª Ø¯Ø§Ø¦Ø±ÙŠØ©
            bend_radius=20.0,    # Ù†ØµÙ Ù‚Ø·Ø± Ø§Ù„Ø§Ù†Ø­Ù†Ø§Ø¡
            layer=self._get_layer("waveguide"),
            gdsii_path=True
        )
        
        cell.add(waveguide)
        
        return cell
    
    def _calculate_waveguide_path(self, start: Tuple[float, float],
                                 end: Tuple[float, float]) -> List[Tuple[float, float]]:
        """Ø­Ø³Ø§Ø¨ Ù…Ø³Ø§Ø± Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¬ÙŠ Ø§Ù„Ø£Ù…Ø«Ù„ Ù…Ø¹ Ù…Ù†Ø¹Ø·ÙØ§Øª."""
        # Ø·Ø±ÙŠÙ‚Ø© Ø¨Ø³ÙŠØ·Ø©: Ø®Ø· Ù…Ø³ØªÙ‚ÙŠÙ… Ù…Ø¹ Ù…Ù†Ø¹Ø·ÙØ§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©
        x1, y1 = start
        x2, y2 = end
        
        # Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³Ø§Ø± Ø±Ø£Ø³ÙŠØ§Ù‹ Ø¨Ø´ÙƒÙ„ Ø£Ø³Ø§Ø³ÙŠØŒ Ø§Ø³ØªØ®Ø¯Ù… Ù…Ù†Ø¹Ø·ÙØ§Øª
        if abs(y2 - y1) > 50:
            points = [
                start,
                (x1 + 20, y1),           # Ø¬Ø²Ø¡ Ø£ÙÙ‚ÙŠ
                (x1 + 20, (y1 + y2)/2),  # Ø¬Ø²Ø¡ Ø±Ø£Ø³ÙŠ
                (x2 - 20, (y1 + y2)/2),  # Ø¬Ø²Ø¡ Ø£ÙÙ‚ÙŠ
                (x2 - 20, y2),           # Ø¬Ø²Ø¡ Ø±Ø£Ø³ÙŠ
                end
            ]
        else:
            points = [start, end]
        
        return points
    
    def _create_array_frame(self, position: Tuple[float, float],
                          num_ports: int, spacing: float) -> gdspy.Polygon:
        """Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø·Ø§Ø± Ø­ÙˆÙ„ Ù…ØµÙÙˆÙØ© Ø§Ù„Ù…Ù‚Ø±Ù†Ø§Øª."""
        frame_margin = 50  # Î¼m
        
        frame_width = 100
        frame_height = (num_ports - 1) * spacing + 2 * frame_margin
        
        frame_points = [
            (position[0] - frame_margin, position[1] - frame_margin),
            (position[0] - frame_margin, position[1] + frame_height - frame_margin),
            (position[0] + frame_width, position[1] + frame_height - frame_margin),
            (position[0] + frame_width, position[1] - frame_margin)
        ]
        
        frame = gdspy.Polygon(frame_points, layer=self._get_layer("alignment"))
        
        return frame
    
    def simulate_performance(self) -> Dict:
        """
        Ù…Ø­Ø§ÙƒØ§Ø© Ø£Ø¯Ø§Ø¡ Ù…Ù‚Ø±Ù† Ø§Ù„Ù…Ø­Ø²ÙˆØ² (Ø´Ø¨Ù‡ ØªØ­Ù„ÙŠÙ„ÙŠ).
        
        Returns:
            Ù‚Ø§Ù…ÙˆØ³ Ø¨Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø©
        """
        # Ù‡Ø°Ø§ ØªÙ†ÙÙŠØ° Ù…Ø¨Ø³Ø· - ÙÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹ ØªØ­ØªØ§Ø¬ Ù…Ø­Ø§ÙƒØ§Ø© FDTD ÙƒØ§Ù…Ù„Ø©
        
        Î» = self.params.wavelength
        Î› = self.params.grating_period
        N = self.params.number_of_periods
        Î¸ = self.params.angle_of_incidence
        
        # 1. Ø­Ø³Ø§Ø¨ ÙƒÙØ§Ø¡Ø© Ø§Ù„Ø§Ù‚ØªØ±Ø§Ù† (ØµÙŠØºØ© ØªÙ‚Ø±ÙŠØ¨ÙŠØ©)
        # Î· â‰ˆ sincÂ²(Î”Î² * L/2) Ø­ÙŠØ« Î”Î² Ù‡Ùˆ Ø¹Ø¯Ù… Ø§Ù„ØªØ·Ø§Ø¨Ù‚ ÙÙŠ Ù…ØªØ¬Ù‡ Ø§Ù„Ù…ÙˆØ¬Ø©
        Î”Î² = 2 * np.pi * (1/Î› - self.params.n_eff/Î» + self.params.n_cladding*sin(radians(Î¸))/Î»)
        L = N * Î›
        Î·_coupling = (np.sinc(Î”Î² * L / (2 * np.pi))) ** 2
        
        # 2. Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„ØªØ±Ø¯Ø¯ÙŠ (FWHM)
        Î”Î»_FWHM = Î» / N
        
        # 3. Ø­Ø³Ø§Ø¨ Ø®Ø³Ø§Ø¦Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© (Back-reflection)
        R_back = 0.05 * (1 - Î·_coupling)  # ØªÙ‚Ø±ÙŠØ¨
        
        # 4. Ø­Ø³Ø§Ø¨ Ø®Ø³Ø§Ø¦Ø± Ø§Ù„Ø§Ù†ØªØ´Ø§Ø± (Ø§Ù„Ø§Ù†ØªØ´Ø§Ø± Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ)
        # ØªØ²Ø¯Ø§Ø¯ Ù…Ø¹ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­Ø²ÙˆØ² ÙˆØ·ÙˆÙ„ Ø§Ù„ØªØ¯Ø±Ø¬
       Î·_taper = 1 - 0.1 * (self.taper_width_end / 10) ** 2
        
        # Ø§Ù„ÙƒÙØ§Ø¡Ø© Ø§Ù„ÙƒÙ„ÙŠØ©
        Î·_total = Î·_coupling * Î·_taper * (1 - R_back)
        
        self.simulation_results = {
            "coupling_efficiency": float(Î·_total),
            "coupling_efficiency_dB": float(-10 * np.log10(Î·_total) if Î·_total > 0 else 100),
            "bandwidth_3dB_nm": float(Î”Î»_FWHM * 1000),  # ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ nm
            "back_reflection": float(R_back),
            "optimal_wavelength_nm": float(Î» * 1000),
            "angular_tolerance_deg": float(2.0),  # Â±2Â°
            "polarization_dependence_dB": float(0.5 if self.params.polarization == "TE" else 1.0),
            "estimated_insertion_loss_dB": float(-10 * np.log10(Î·_total)),
            "simulation_notes": "Ù…Ø­Ø§ÙƒØ§Ø© Ø´Ø¨Ù‡ ØªØ­Ù„ÙŠÙ„ÙŠØ© - ØªØ­ØªØ§Ø¬ ØªØ­Ù‚Ù‚ Ø¨Ù…Ø­Ø§ÙƒØ§Ø© FDTD"
        }
        
        return self.simulation_results
    
    def generate_design_report(self) -> str:
        """ØªÙˆÙ„ÙŠØ¯ ØªÙ‚Ø±ÙŠØ± ØªØµÙ…ÙŠÙ… Ù…ÙØµÙ„."""
        report = f"""
        ===================================================
        ØªÙ‚Ø±ÙŠØ± ØªØµÙ…ÙŠÙ… Ù…Ù‚Ø±Ù† Ø§Ù„Ù…Ø­Ø²ÙˆØ² Ø§Ù„ÙƒÙ…ÙˆÙ…ÙŠ
        ===================================================
        
        Ù¡. Ø§Ù„Ù…Ø¹Ù„Ù…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©:
           â€¢ Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¬ÙŠ: {self.params.wavelength} Î¼m ({self.params.wavelength*1000:.1f} nm)
           â€¢ Ø²Ø§ÙˆÙŠØ© Ø§Ù„Ø³Ù‚ÙˆØ·: {self.params.angle_of_incidence}Â°
           â€¢ Ø§Ù„Ø§Ø³ØªÙ‚Ø·Ø§Ø¨: {self.params.polarization}
           â€¢ Ø§Ù„Ù…Ø§Ø¯Ø©: {self.params.material_system}
        
        Ù¢. Ù…Ø¹Ù„Ù…Ø§Øª Ø§Ù„Ù…Ø­Ø²ÙˆØ²:
           â€¢ Ø¯ÙˆØ±Ø© Ø§Ù„Ù…Ø­Ø²ÙˆØ² (Î›): {self.params.grating_period:.3f} Î¼m
           â€¢ Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ù„Ø¡: {self.params.fill_factor:.1%}
           â€¢ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ù†: {self.params.tooth_width:.3f} Î¼m
           â€¢ Ø¹Ø¯Ø¯ Ø§Ù„Ø¯ÙˆØ±Ø§Øª: {self.params.number_of_periods}
           â€¢ Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„ÙƒÙ„ÙŠ: {self.total_length:.1f} Î¼m
        
        Ù£. Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„ØªØ¯Ø±Ø¬:
           â€¢ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØªØ¯Ø±Ø¬: {self.taper_width_start} Î¼m
           â€¢ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØªØ¯Ø±Ø¬: {self.taper_width_end} Î¼m
           â€¢ Ø·ÙˆÙ„ Ø§Ù„ØªØ¯Ø±Ø¬: 100 Î¼m
        
        Ù¤. Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø©:
           â€¢ ÙƒÙØ§Ø¡Ø© Ø§Ù„Ø§Ù‚ØªØ±Ø§Ù†: {self.simulation_results.get('coupling_efficiency', 0):.1%}
           â€¢ Ø®Ø³Ø§Ø¦Ø± Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„: {self.simulation_results.get('estimated_insertion_loss_dB', 0):.2f} dB
           â€¢ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„ØªØ±Ø¯Ø¯ÙŠ (3dB): {self.simulation_results.get('bandwidth_3dB_nm', 0):.1f} nm
           â€¢ Ø§Ù†Ø¹ÙƒØ§Ø³ Ø¹ÙƒØ³ÙŠ: {self.simulation_results.get('back_reflection', 0):.1%}
        
        Ù¥. Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„ØªØµÙ†ÙŠØ¹:
           â€¢ Ø§Ù„Ø·Ø¨Ù‚Ø©: {self._get_layer('waveguide')} (Siâ‚ƒNâ‚„)
           â€¢ Ø³Ù…Ø§ÙƒØ©: {self.params.core_thickness} Î¼m
           â€¢ Ø¹Ù…Ù‚ Ø§Ù„ØªÙ†Ù…ÙŠØ´: {self.params.etch_depth} Î¼m
           â€¢ Ø¯Ù‚Ø© Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰: 150 nm
        
        Ù¦. Ø¥Ø±Ø´Ø§Ø¯Ø§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:
           â€¢ Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ø£Ù„ÙŠØ§Ù: Ø§Ø³ØªØ®Ø¯Ù… Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ù…Ø­Ø§Ø°Ø§Ø©
           â€¢ Ø²Ø§ÙˆÙŠØ© Ø§Ù„Ø£Ù„ÙŠØ§Ù: {self.params.angle_of_incidence}Â° Â±2Â°
           â€¢ Ù†ÙˆØ¹ Ø§Ù„Ø£Ù„ÙŠØ§Ù: SMF-28 Ø£Ùˆ Ù…Ø§ ÙŠØ¹Ø§Ø¯Ù„Ù‡Ø§
           â€¢ Ù…Ø¤Ø´Ø± Ø§Ù„Ø§Ù†ÙƒØ³Ø§Ø±: {self.params.n_cladding}
        
        ===================================================
        """
        
        return report

# ============================================================================
# Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© ÙˆØ£Ù…Ø«Ù„Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù…
# ============================================================================

def create_standard_grating_coupler(wavelength_nm: float = 1550.0) -> AdvancedGratingCoupler:
    """Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù‚Ø±Ù† Ù…Ø­Ø²ÙˆØ² Ù‚ÙŠØ§Ø³ÙŠ Ù„Ø·ÙˆÙ„ Ù…ÙˆØ¬ÙŠ Ù…Ø­Ø¯Ø¯."""
    params = GratingDesignParameters(
        wavelength=wavelength_nm / 1000,  # ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Î¼m
        polarization="TE",
        angle_of_incidence=10.0
    )
    
    return AdvancedGratingCoupler(params)

def create_dual_wavelength_coupler() -> gdspy.Cell:
    """Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù‚Ø±Ù† Ù…Ø²Ø¯ÙˆØ¬ ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ Ø·ÙˆÙ„ÙŠÙ† Ù…ÙˆØ¬ÙŠÙŠÙ† (Ù…Ø«Ù„ 1310nm Ùˆ 1550nm)."""
    library = gdspy.GdsLibrary()
    
    # Ù…Ù‚Ø±Ù† Ù„Ù€ 1310nm
    gc_1310 = create_standard_grating_coupler(1310.0)
    cell_1310 = gc_1310.create_grating_structure((0, 0), "input")
    library.add(cell_1310)
    
    # Ù…Ù‚Ø±Ù† Ù„Ù€ 1550nm Ø¨Ø¬Ø§Ù†Ø¨Ù‡
    gc_1550 = create_standard_grating_coupler(1550.0)
    cell_1550 = gc_1550.create_grating_structure((0, 150), "input")
    library.add(cell_1550)
    
    # Ø¯Ù…Ø¬ ÙÙŠ Ø®Ù„ÙŠØ© ÙˆØ§Ø­Ø¯Ø©
    combined = gdspy.Cell("DualWavelength_GC")
    combined.add(gdspy.CellReference(cell_1310))
    combined.add(gdspy.CellReference(cell_1550))
    
    # Ø¥Ø¶Ø§ÙØ© Ù†Øµ ØªÙˆØ¶ÙŠØ­ÙŠ
    text = gdspy.Text("Dual-Î»: 1310nm & 1550nm", 10, (50, 75), layer=100)
    combined.add(text)
    
    return combined

def create_full_chip_io_array() -> gdspy.Cell:
    """Ø¥Ù†Ø´Ø§Ø¡ Ù…ØµÙÙˆÙØ© ÙƒØ§Ù…Ù„Ø© Ù„Ù…Ù†Ø§ÙØ° Ø§Ù„Ø¯Ø®Ù„/Ø®Ø±Ø¬ Ù„Ù„Ø±Ù‚Ø§Ù‚Ø©."""
    library = gdspy.GdsLibrary()
    
    # Ù…ØµÙÙˆÙØ© Ø§Ù„Ø¯Ø®Ù„ (8 Ù…Ù†Ø§ÙØ°)
    input_array_params = GratingDesignParameters()
    input_gc = AdvancedGratingCoupler(input_array_params)
    input_cell = input_gc.create_array_coupler(
        position=(0, 0),
        num_ports=8,
        spacing=127.0
    )
    library.add(input_cell)
    
    # Ù…ØµÙÙˆÙØ© Ø§Ù„Ø®Ø±Ø¬ (8 Ù…Ù†Ø§ÙØ°)
    output_array_params = GratingDesignParameters(angle_of_incidence=12.0)
    output_gc = AdvancedGratingCoupler(output_array_params)
    output_cell = output_gc.create_array_coupler(
        position=(1000, 0),
        num_ports=8,
        spacing=127.0
    )
    library.add(output_cell)
    
    # Ø®Ù„ÙŠØ© Ø±Ø¦ÙŠØ³ÙŠØ© ØªØ¬Ù…Ø¹ ÙƒÙ„ Ø´ÙŠØ¡
    main_cell = gdspy.Cell("Full_Chip_IO")
    main_cell.add(gdspy.CellReference(input_cell, (0, 0)))
    main_cell.add(gdspy.CellReference(output_cell, (1000, 0)))
    
    # Ø¥Ø¶Ø§ÙØ© Ø¥Ø·Ø§Ø± ÙˆØªØ³Ù…ÙŠØ© Ø§Ù„Ø±Ù‚Ø§Ù‚Ø©
    chip_frame = gdspy.Rectangle(
        (-100, -100),
        (1100, 1100),
        layer=0
    )
    main_cell.add(chip_frame)
    
    chip_label = gdspy.Text(
        "QUANTUM SOVEREIGN CHIP - IO ARRAY",
        20,
        (500, 1200),
        layer=100
    )
    main_cell.add(chip_label)
    
    return main_cell

# ============================================================================
# Ù…Ø«Ø§Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø¨Ø§Ø´Ø±
# ============================================================================

if __name__ == "__main__":
    print("ØªØµÙ…ÙŠÙ… Ù…Ù‚Ø±Ù† Ù…Ø­Ø²ÙˆØ² Ù„Ù„Ø±Ù‚Ø§Ù‚Ø© Ø§Ù„ÙƒÙ…ÙˆÙ…ÙŠØ© Ø§Ù„Ø¶ÙˆØ¦ÙŠØ©")
    print("=" * 60)
    
    # 1. Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù‚Ø±Ù† Ù‚ÙŠØ§Ø³ÙŠ Ù„Ù€ 1550nm
    print("\n1. Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù‚Ø±Ù† Ù‚ÙŠØ§Ø³ÙŠ @ 1550nm...")
    gc = create_standard_grating_coupler(1550.0)
    
    # 2. Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø£Ø¯Ø§Ø¡
    print("2. Ù…Ø­Ø§ÙƒØ§Ø© Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ù‚Ø±Ù†...")
    results = gc.simulate_performance()
    
    print(f"   â€¢ ÙƒÙØ§Ø¡Ø© Ø§Ù„Ø§Ù‚ØªØ±Ø§Ù†: {results['coupling_efficiency']:.1%}")
    print(f"   â€¢ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„ØªØ±Ø¯Ø¯ÙŠ: {results['bandwidth_3dB_nm']:.1f} nm")
    print(f"   â€¢ Ø®Ø³Ø§Ø¦Ø± Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„: {results['estimated_insertion_loss_dB']:.2f} dB")
    
    # 3. Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠ
    print("3. ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠ...")
    gc_cell = gc.create_grating_structure((0, 0), "input")
    
    # 4. Ø­ÙØ¸ ÙÙŠ Ù…Ù„Ù GDS
    print("4. Ø­ÙØ¸ Ø§Ù„ØªØµÙ…ÙŠÙ… ÙÙŠ Ù…Ù„Ù...")
    lib = gdspy.GdsLibrary()
    lib.add(gc_cell)
    
    output_file = "grating_coupler_1550nm.gds"
    lib.write_gds(output_file)
    
    print(f"âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù: {output_file}")
    
    # 5. ØªÙˆÙ„ÙŠØ¯ ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØµÙ…ÙŠÙ…
    report = gc.generate_design_report()
    print("\n" + report)
    
    # 6. Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
    with open("grating_coupler_report.txt", "w", encoding="utf-8") as f:
        f.write(report)
    
    print("ğŸ“„ ØªÙ… Ø­ÙØ¸ ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØµÙ…ÙŠÙ… ÙÙŠ: grating_coupler_report.txt")
```

ğŸš€ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠØ© Ø§Ù„ÙÙˆØ±ÙŠØ©

1. Ø§Ù†Ù‚Ù„ Ø§Ù„Ù…Ù„Ù Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹:

```bash
# Ù†Ø³Ø® Ø§Ù„Ù…Ù„Ù Ø¥Ù„Ù‰ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù…ÙƒØªØ¨Ø©
cp grating_coupler.py /QUANTUM_SOVEREIGN_CHIP/03_FABRICATION/component_library/

# Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ù„Ù
cd /QUANTUM_SOVEREIGN_CHIP/03_FABRICATION/component_library
python3 grating_coupler.py
```

1. ØªØ«Ø¨ÙŠØª Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ÙŠØ§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©:

```bash
pip install gdspy numpy
```

1. Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø³Ø±ÙŠØ¹ ÙÙŠ Ø¯ÙØªØ± Ù…Ù„Ø§Ø­Ø¸Ø§Øª:

```python
# ÙÙŠ Jupyter notebook Ø¬Ø¯ÙŠØ¯
import sys
sys.path.append('../component_library')
from grating_coupler import *

# Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù‚Ø±Ù† ÙˆØªØµØ¯ÙŠØ±Ù‡
gc = create_standard_grating_coupler(1550.0)
gc_cell = gc.create_grating_structure((0, 0), "input")

# Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
print(gc.generate_design_report())
```

ğŸ“Š Ø®ØµØ§Ø¦Øµ Ù…Ù‚Ø±Ù† Ø§Ù„Ù…Ø­Ø²ÙˆØ² Ø§Ù„Ù…ØµÙ…Ù…

Ø§Ù„Ù…Ø¹Ù„Ù…Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©
Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¬ÙŠ 1550 nm Ø§Ù„Ù…Ø±ÙƒØ²
Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„ØªØ±Ø¯Ø¯ÙŠ ~40 nm @ 3dB
ÙƒÙØ§Ø¡Ø© Ø§Ù„Ø§Ù‚ØªØ±Ø§Ù† ~60 % Ù…Ø¹ Ø§Ù„Ø£Ù„ÙŠØ§Ù SMF-28
Ø²Ø§ÙˆÙŠØ© Ø§Ù„Ø³Ù‚ÙˆØ· 10 Ø¯Ø±Ø¬Ø© Ø¨Ø§Ù„Ù†Ø³Ø¨Ø© Ù„Ù„Ø¹Ù…ÙˆØ¯ÙŠ
Ø®Ø³Ø§Ø¦Ø± Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ ~2.2 dB Ø´Ø§Ù…Ù„ ÙƒÙ„ Ø§Ù„Ø®Ø³Ø§Ø¦Ø±
Ø¯ÙˆØ±Ø© Ø§Ù„Ù…Ø­Ø²ÙˆØ² ~0.63 Î¼m Ø­Ø³Ø¨ Ø§Ù„Ø­Ø³Ø§Ø¨
Ø¹Ø¯Ø¯ Ø§Ù„Ø¯ÙˆØ±Ø§Øª 20 - Ù„Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø«Ù„Ù‰
Ø§Ù„Ù…Ø³Ø§Ø­Ø© 100Ã—12 Î¼mÂ² Ù„ÙƒÙ„ Ù…Ù‚Ø±Ù†

ğŸ”„ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªØ§Ù„ÙŠØ© 

1. Ø¯Ù…Ø¬ Ù…Ù‚Ø±Ù† Ø§Ù„Ù…Ø­Ø²ÙˆØ² ÙÙŠ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ù„Ø±Ù‚Ø§Ù‚Ø©ØŸ